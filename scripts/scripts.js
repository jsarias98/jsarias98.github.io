"use strict";angular.module("tiendAppApp",["ui.router","ui.materialize","firebase","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.pagination","ui.grid.cellNav"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/Dashboard/Marcas"),$stateProvider.state("Dashboard",{url:"/Dashboard",templateUrl:"views/layout/dashboard.html",controller:"DashboardCtrl"}).state("Marcas",{url:"/Marcas",parent:"Dashboard",templateUrl:"views/marcas.html",controller:"MarcasCtrl"}).state("Productos",{url:"/Productos",parent:"Dashboard",templateUrl:"views/productos.html",controller:"ProductosCtrl"})}]),angular.module("tiendAppApp").controller("DashboardCtrl",["$scope","$state",function($scope,$state){$scope.$state=$state,$(document).ready(function(){$(".button-collapse").sideNav({closeOnClick:!0})})}]),angular.module("tiendAppApp").controller("MarcasCtrl",["$scope","$state","$timeout","$firebaseArray",function($scope,$state,$timeout,$firebaseArray){function scroll(){$("html, body").animate({scrollTop:0},1e3)}$scope.panel_title_form="Registro de marcas",$scope.button_title_form="Registrar",$scope.marca={},$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100);var ref=firebase.database().ref().child("marcas");$scope.marcas=$firebaseArray(ref),$scope.EnviarMarca=function(){"Registro de marcas"==$scope.panel_title_form?($scope.marcas.$add({referencia:$scope.marca.referencia,nombre:$scope.marca.nombre}),swal("Registrado"," ","success")):($scope.marcas.$save($scope.marca),swal("Actualizado"," ","success")),$scope.panel_title_form="Registro de marcas",$scope.button_title_form="Registrar",$scope.marca={},$scope.gridOptions.data=$scope.marcas};$scope.gridOptions={columnDefs:[{field:"referencia",width:"33%",type:"number",minWidth:160},{field:"nombre",width:"33%",minWidth:160,enableSorting:!0},{name:"Opciones",enableFiltering:!1,cellTemplate:'<div> <a type="button" class="waves-effect waves-light btn yellow accent-4" ng-click="grid.appScope.editar(row.entity)">Editar</a><a type="button" class="waves-effect waves-light btn red accent-4" ng-click="grid.appScope.borrar(row.entity)">Borrar</a></div>',width:"33%",minWidth:240}]},$scope.gridOptions.data=$scope.marcas,$scope.borrar=function(m){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la marca?",type:"warning",showCancelButton:!0,confirmButtonColor:"#b71c1c",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!0,showLoaderOnConfirm:!0},function(){$scope.marcas.$remove(m)})},$scope.editar=function(m){scroll(),$scope.panel_title_form="Actualizar marca",$scope.button_title_form="Actualizar",delete m.$$hashKey,$scope.marca=m},$scope.cancelar=function(){$scope.panel_title_form="Registro de marcas",$scope.button_title_form="Registrar",$scope.marca={},$scope.gridOptions.data=$firebaseArray(ref)},scroll()}]),angular.module("tiendAppApp").controller("ProductosCtrl",["$scope","$state","$timeout","$firebaseArray",function($scope,$state,$timeout,$firebaseArray){function scroll(){$("html, body").animate({scrollTop:0},1e3)}function fecha(fecha){var date=new Date(fecha).getMonth()+1;return date+="-"+new Date(fecha).getDate(),date+="-"+new Date(fecha).getFullYear()}$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar",$scope.producto={};var refmarcas=firebase.database().ref().child("marcas");$scope.marcas=$firebaseArray(refmarcas);var ref=firebase.database().ref().child("productos");$scope.productos=$firebaseArray(ref),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.producto={},$scope.tallas=[{id:"s",nombre:"s"},{id:"m",nombre:"m"},{id:"l",nombre:"l"}];$scope.gridOptions={columnDefs:[{field:"nombre",width:"15%",minWidth:160},{field:"talla",width:"4%",minWidth:60,enableSorting:!0},{field:"marca",width:"14%",cellTemplate:"<div>{{grid.appScope.obtenerMarca(row.entity.marca)}}</div>",minWidth:80},{field:"cantidad",width:"10%",type:"number",minWidth:160},{field:"fechaEmbarque",displayName:"Fecha de embarque",width:"17%",minWidth:150},{field:"observaciones",width:"20%",minWidth:160},{name:"Opciones",enableFiltering:!1,cellTemplate:'<div> <a type="button" class="waves-effect waves-light btn yellow accent-4" ng-click="grid.appScope.editar(row.entity)">Editar</a><a type="button" class="waves-effect waves-light btn red accent-4" ng-click="grid.appScope.borrar(row.entity)">Borrar</a></div>',width:"29%",minWidth:240}]};var marca;$scope.obtenerMarca=function(mar){return $scope.marcas.forEach(function(element){element.$id==mar&&(marca=element.nombre)}),marca},$scope.gridOptions.data=$scope.productos,$scope.EnviarProducto=function(){"Registro de Productos"==$scope.panel_title_form?($scope.productos.$add({nombre:$scope.producto.nombre,talla:$scope.producto.talla,marca:$scope.producto.marca,cantidad:$scope.producto.cantidad,fechaEmbarque:fecha($scope.producto.fechaEmbarque),observaciones:$scope.producto.observaciones}),swal("Registrado"," ","success")):($scope.producto.fechaEmbarque=fecha($scope.producto.fechaEmbarque),$scope.productos.$save($scope.producto),swal("Actualizado"," ","success")),$scope.button_title_form="Registrar",$scope.producto={},$scope.gridOptions.data=$scope.productos},$scope.editar=function(m){scroll(),$scope.panel_title_form="Actualizar producto",$scope.button_title_form="Actualizar",delete m.$$hashKey,$scope.producto=m,$scope.producto.fechaEmbarque=new Date(Date.parse($scope.producto.fechaEmbarque))},$scope.borrar=function(p){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar el producto?",type:"warning",showCancelButton:!0,confirmButtonColor:"#b71c1c",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!0,showLoaderOnConfirm:!0},function(){$scope.productos.$remove(p)})},$scope.cancelar=function(){$scope.panel_title_form="Registro de marcas",$scope.button_title_form="Registrar",$scope.producto={},$scope.gridOptions.data=$firebaseArray(ref)},scroll()}]);